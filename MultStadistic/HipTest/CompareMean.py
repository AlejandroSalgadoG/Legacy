import numpy as np
from scipy.stats import f
from scipy.spatial.distance import mahalanobis
import matplotlib.pyplot as plt

X1 = [ [15, 17, 24, 14], 
       [17, 15, 32, 26], 
       [15, 14, 29, 23], 
       [13, 12, 10, 16], 
       [20, 17, 26, 28], 
       [15, 21, 26, 21], 
       [15, 13, 26, 22], 
       [13, 5 , 22, 22], 
       [14, 7 , 30, 17], 
       [17, 15, 30, 27], 
       [17, 17, 26, 20], 
       [17, 20, 28, 24], 
       [15, 15, 29, 24], 
       [18, 19, 32, 28], 
       [18, 18, 31, 27], 
       [15, 14, 26, 21], 
       [18, 17, 33, 26], 
       [10, 14, 19, 17], 
       [18, 21, 30, 29], 
       [18, 21, 34, 26], 
       [13, 17, 30, 24], 
       [16, 16, 16, 16], 
       [11, 15, 25, 23], 
       [16, 13, 26, 16], 
       [16, 13, 23, 21], 
       [18, 18, 34, 24], 
       [16, 15, 28, 27], 
       [15, 16, 29, 24], 
       [18, 19, 32, 23], 
       [18, 16, 33, 23], 
       [17, 20, 21, 21], 
       [19, 19, 30, 28] ]

X2 = [ [13, 14, 12, 21],
       [14, 12, 14, 26],
       [12, 19, 21, 21],
       [12, 13, 10, 16],
       [11, 20, 16, 16],
       [12, 9 , 14, 18],
       [10, 13, 18, 24],
       [10, 8 , 13, 23],
       [12, 20, 19, 23],
       [11, 10, 11, 27],
       [12, 18, 25, 25],
       [14, 18, 13, 26],
       [14, 10, 25, 28],
       [13, 16, 8 , 14],
       [14, 8 , 13, 25],
       [13, 16, 23, 28],
       [16, 21, 26, 26],
       [14, 17, 14, 14],
       [16, 16, 15, 23],
       [13, 16, 23, 24],
       [2 , 6 , 16, 21],
       [14, 16, 22, 26],
       [17, 17, 22, 28],
       [16, 13, 16, 14],
       [15, 14, 20, 26],
       [12, 10, 12, 9 ],
       [14, 17, 24, 23],
       [13, 15, 18, 20],
       [11, 16, 18, 28],
       [7 , 7 , 19, 18],
       [12, 15, 7 , 28],
       [6 , 5 , 6 , 13] ]

p = 4
n1 = len(X1)
n2 = len(X2)

y1_bar = np.mean( X1, axis=0 )
y2_bar = np.mean( X2, axis=0 )

X1_T = np.array(X1).T
X2_T = np.array(X2).T

s1 = np.cov( X1_T )
s2 = np.cov( X2_T )

sp = (n1-1)/(n1+n2-2) * s1 + (n2-1)/(n1+n2-2) * s2
sp_1 = np.linalg.inv( sp )

t_2 = (n1*n2)/(n1+n2) * mahalanobis( y1_bar, y2_bar, sp_1 ) ** 2
F_test = (n1+n2-p-1)/((n1+n2-2)*p) * t_2
F = f.ppf(0.95, p, n1+n2-p-1)

a = np.matmul( sp_1, y1_bar-y2_bar )
print( "discriminant coefficient =", a )

x = np.linspace(f.ppf(0.01, p, n1+n2-p-1), f.ppf(0.99, p, n1+n2-p-1), 100)
plt.plot( x, f.pdf(x, p, n1+n2-p-1) )
plt.vlines( F, 0, f.pdf(F, p, n1+n2-p-1) )
plt.vlines( F_test, 0, f.pdf(F_test, p, n1+n2-p-1), color='k' )

plt.xlim( f.ppf(0.01, p, n1+n2-p-1), f.ppf(0.99, p, n1+n2-p-1) )
plt.ylim( 0, 0.8 )
plt.show()
